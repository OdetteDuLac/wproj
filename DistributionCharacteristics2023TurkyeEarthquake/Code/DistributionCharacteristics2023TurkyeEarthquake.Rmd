---
title: "Distribution and Characteristics of the 2023 Turkye Earthquake"
author: "OdetteDuLac, Teammate 1, and Teammate 2"
output: 
  bookdown::html_document2:
    code_folding: hide
    toc: true
    number_sections: false
    toc_float:
      collapsed: true
    theme: lumen
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup1, echo=FALSE, message=FALSE, warning=FALSE, error = FALSE, include=FALSE}
require(knitr)
require(kfigr)
knitr::opts_chunk$set(
	echo = FALSE,
	error = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r setup2, message=FALSE, echo=FALSE, warning=FALSE}
# Set your working directory
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# Load your packages
# general
library(tidyverse)
library(here)
library(lubridate)
library(httr)
library(readxl)
# spatial
library(sf)
library(gstat)
library(leaflet)
library(mapview)
library(raster)
# graphics
library(ggplot2)
library(ggthemes)
# GLM
library(agricolae)
library(zoo)

# Set your ggplot theme
theme_set(theme_minimal())
```

# OdetteDuLac Contributions
Idea Formulation
Data Discovery
Setup and Data Download
Rationale and Research Questions
Data Description (Dataset Information)
Exploratory Analysis
README

# Setup and Data
```{r dataload1, error=FALSE, message=FALSE, warning=FALSE}
## administrative boundaries of Turkiye
tur.adm0 <- st_read(here("Data/Shapefiles/geoBoundaries-TUR-ADM0-all/geoBoundaries-TUR-ADM0_simplified.shp"))
tur.adm1 <- st_read(here("Data/Shapefiles/geoBoundaries-TUR-ADM1-all/geoBoundaries-TUR-ADM1_simplified.shp"))
tur.adm2 <- st_read(here("Data/Shapefiles/geoBoundaries-TUR-ADM2-all/geoBoundaries-TUR-ADM2_simplified.shp"))
```

```{r dataload2, message=FALSE, warning=FALSE, error = FALSE, echo=FALSE}
### earthquake data from USGS Earthquake Catalog
# create bounding box of Turkiye to input coordinates into USGS EC API
tur.bbox <- st_bbox(tur.adm0)
# create string of bounding box coordinates for API url
rectangle <- paste0("minlatitude=", tur.bbox[1], 
                    "&minlongitude=", tur.bbox[2], 
                    "&maxlatitude=", tur.bbox[3], 
                    "&maxlongitude=", tur.bbox[4])
# USGS Earthquake Catalog API query; February 5, 2023 to March 5, 2023; 
# minimum magnitude of 0, want all earthquakes during this period csv format 
tur.USGS.EQC <- GET(paste0("https://earthquake.usgs.gov/fdsnws/event/1/query?format=csv&starttime=2023-02-05&endtime=2023-03-05&", rectangle, "&minmagnitude=0.0"))

# parse contents of query and create data frame
EQC.data <- content(tur.USGS.EQC, "text")
EQC.data.df <- read.csv(text = EQC.data)

# save earthquake data to csv; files can be overwritten when .Rmd is run
write.csv(EQC.data.df, row.names = FALSE, file = here("Data/Tabular/TUR_USGS_EQC_FebMar2023.csv"))
```

```{r dataload3, message=FALSE, warning=FALSE, error = FALSE, echo=FALSE}
### destroyed building data from UN OCHA HDX portal; data set updated daily
# download, unzip, and read
url <- "https://s3.us-east-1.amazonaws.com/exports-stage.hotosm.org/hotosm_tur_destroyed_buildings_polygons_csv_csv_uid_d3ce51f1-f046-4df9-b0df-2059159c0ece.zip"
temp <- tempfile()
download.file(url, temp)
buildings <- read.csv(unz(temp, "hotosm_tur_destroyed_buildings_polygons_csv.csv"))
unlink(temp)

# save dataset; files can be overwritten when .Rmd is run
write.csv(buildings, row.names = FALSE, file = here("Data/Tabular/TUR_HDX_destroyedBuildings.csv"))

```

```{r dataload4, message=FALSE, warning=FALSE, error = FALSE, echo=FALSE}
### twitter earthquake communications data from UN OCHA HDX portal; data set updated monthly
# download data
# download.file("https://data.humdata.org/dataset/a22adc4d-4ae3-4252-a9ba-5d7278f17282/resource/ae7a53d1-7e09-4eaa-9790-13ddcb140e62/download/help_requests_twitter.xlsx",  here("Data/Tabular/TUR_HDX_twitterHelp.xlsx"))
# 
# download.file("https://data.humdata.org/dataset/a22adc4d-4ae3-4252-a9ba-5d7278f17282/resource/ed7a25db-e2fb-402a-a433-e3da0b62d3c4/download/shelter_requests_twitter.xlsx",  here("Data/Tabular/TUR_HDX_twitterShelter.xlsx"))
# 
# download.file("https://data.humdata.org/dataset/a22adc4d-4ae3-4252-a9ba-5d7278f17282/resource/1e6539f1-d7c0-40d2-bfe9-09f4dd0485c7/download/missing_people_reports_twitter.xlsx",  here("Data/Tabular/TUR_HDX_twitterMissingPeople.xlsx"))
# 
# download.file("https://data.humdata.org/dataset/a22adc4d-4ae3-4252-a9ba-5d7278f17282/resource/3f8c3277-cd31-4952-884f-c8ebe2188a00/download/damage_images_twitter.xlsx",  here("Data/Tabular/TUR_HDX_twitterDamageImages.xlsx"))

# read in data
twt.help <- as.data.frame(read_excel(here("Data/Tabular/TUR_HDX_twitterHelp.xlsx")))
twt.shelter <- as.data.frame(read_excel(here("Data/Tabular/TUR_HDX_twitterShelter.xlsx")))
twt.missingPeople <- as.data.frame(read_excel( here("Data/Tabular/TUR_HDX_twitterMissingPeople.xlsx")))
twt.damageImages <- as.data.frame(read_excel(here("Data/Tabular/TUR_HDX_twitterDamageImages.xlsx")))
```

# Rationale and Research Questions
On February 6, 2023 a 7.8 magnitude earthquake hit northwest section Gaziantep, it's epicenter near the town of Nurdağı.Less than 12 hours later another 7.5 magnitude earthquake the neighboring province of Kahramanmaraş. The earthquakes had severe damaging impacts in 11 provinces of southeast Türkiye as well as northwest Syria, including in the cities of Idlib and Aleppo, and their effects were felt as far away as Lebanon, Palestine, and Egypt. Strong aftershocks from the earthquakes lasted for more than a month (Kawoosa, 2023), leading to the continued destruction of buildings already damaged in the initial earthquakes. Some aftershocks are still occurring today.

The earthquakes caused more than 55,000 people were killed and more than 130,000 people were injured across Türkiye and Syria as a result of the earthquakes, and tens of thousands of people are missing and millions displaced.

To learn more about some of the impacts of the earthquake we decided to examine the distribution and characteristics of 2023 Türkiye-Syria earthquakes and their aftershocks within the borders of Türkiye to understand the relationship between earthquake magnitude and depth using GLMs and visually compares the occurrence of building destruction with these earthquake variables as well as the human response to the destruction, as represented by twitter activity.

To conduct this analysis we used data from the USGS Earthquake Catalog on the earthquakes and data from the UN Office of Humanitarian Affairs' Humanitarian Data Exchange portal on building damage and twitter activity. We also used administrative boundary data from the geoBoundaries package created by the College of William and Mary's geoLab.

### Research Questions:
1. How is earthquake depth correlated to earthquake magnitude? 
2. How are depth and magnitude related to destruction of buildings?
3. What is the distribution of earthquake-related twitter activity?
4. How does this distribution look in relation to the distribution of destroyed buildings? 

\newpage

# Dataset Information

This project used four main datasets: Administrative Boundary Layers, Earthquake Data, Destroyed Buildings Data, and Twitter Activity Data. 

The Administrative Boundary Layers were downloaded from the geoBoundaries dataset created by the geoLab at the College of William and Mary. Administrative boundaries for the country, province, and district level were downloaded and saved as shapefiles. 

The Earthquake Data was downloaded from the US Geological Survey Earthquake Catalog using their API. It is saved in a csv format and is a point layer of earthquake data from February 5 to march 5, 2023. The dataset includes measures of depth, magnitude, time, latitude, and longitude as well as other statistics related to measuring and detection errors.

The Destroyed Buildings Data was pulled from the UN Office of UN Office of Humanitarian Affairs' Humanitarian Data Exchange Portal. It is saved in a csv format and is a point layer of destroyed building data that is updated daily and curated using Open Street Map and Map Roulette. 

The Twitter Activity Data was pulled from the UN Office of UN Office of Humanitarian Affairs' Humanitarian Data Exchange Portal. It is saved in a xlsx format and is tabular data aggregated from points to administrative level 2 (distric) polygons. It includes separate files of missing people reports, help requests, shelter requests, and damage reports shared through images.
  
Because of the very specific nature of the datasets and the spatial analysis conducted, the data did not require serious wrangling. Some datasets, such as the Earthquake dataset, were wrangled and processed to create new data and time columns using lubridate and distance columns. Some datasets, such as the administrative boundary layers and the Earthquake dataset, were reprojected to allow for spatial analayes, such as interpolation.

Table \@ref(tab:datasetInfo) shows a summary of the dataset information. 

```{r datasetInfo, anchor="table", tab.cap="Dataset Summary", tab.align = "center"}
# create data frame of data set information
datasets <- c("Administrative Boundary Layers", "Earthquake Data", "Destroyed Buildings Data", "Twitter Activity Data")
description <- c("polygons", "points", "points", "points aggregated to ADM 2 polygons")
variables <- c("name; type (ADM level); geometry", "date/time; latitude; longitude; depth (km); magnitude; place; measures of error; measurement sources; ID", "source; damage_event; date; longigute; latitude", "district; population; frequency of images; frequency of tweets; impact score; impact category")
information <- c("ADM 0, ADM 1, and ADM 2", "earthquakes Feb. 5-Mar. 5, 2023", "destroyed buildings", "help requests, shelter requests, missing people reports, damage reports (images)")
projection <- c("4326", "4326", "4326", "NA")
format <- c("shapefile", ".csv", ".csv", ".xlsx")
sources <- c("geoBoundaries", "USGS Earthquake Catalog", "UN OCHA HDX", "UN OCHA HDX")

datasets.df <- data.frame(datasets, description, variables, information, projection, format, sources)

#Use the `kable` function to produce the table
knitr::kable(datasets.df, caption = "Summary of Datasets", col.names = c("Name","Description", "Variables", "Information", "Original Projection", "Format", "Source"))
```

\newpage

# Exploratory Analysis 

The map below shows extent of Turkiye within which our analysis of the earthquake related data will take place. Moreover, the administrative boundaries for provinces and districts are shown with their labels. This will aid in situating the earthquake, damage, and twitter data within the affected 11 provinces and their relevant districts.

```{r exploratoryMapsPlots1, anchor= "figure", fig.align="center", fig.cap="Turkiye Administrative Boundaries", message=FALSE, warning=FALSE}
## Administrative Boundaries
# plot and check administrative boundaries
mapviewOptions(basemaps = "CartoDB.Positron")
mapView(list(tur.adm0, tur.adm1, tur.adm2), 
        col.regions = list("lightblue","lavender", "darkgreen"),
        label = list(as.character(tur.adm0$shapeName), as.character(tur.adm1$shapeName), as.character(tur.adm2$shapeName)),
        layer.name = list("Turkiye", "Turkiye Provinces", "Turkiye Districts"))
```

Figure \@ref(fig:exploratoryMapsPlots2) below illustrates the rough distribution of the earthquakes that occurred between February 5 and March 5, 2023. The earthquakes occurred in a large south to north swath from Hatay to the Black Sea region, with most of the earthquakes concentrating in the South, particularly near Hatay, Gaziantep, Şanlıurfa, and Kahramanmaraş.

```{r exploratoryMapsPlots2, fig.align="center", fig.cap="Distirbution of Earthquake Points", message=FALSE, warning=FALSE, anchor="figure"}
## Earthquake Data
# preview data
head(EQC.data.df)

# plot earthquake points to see quick distribution
ggplot()+
  geom_sf(data = tur.adm0, fill = "azure", color = "darkgray") +
  geom_point(data = EQC.data.df, aes(x=latitude, y=longitude), color = "darkred", size = 0.5) +
  labs(title = "Turkiye Earthquakes Feb. 5-Mar. 5, 2023")
```

### Question 1: How are depth and magnitude related to destruction of buildings?

Figure \@ref(fig:exploratoryMapsPlots3) below illustrates the rough distribution of buildings destroyed as a result of the earthquakes. Unlike the distribution of the earthquakes that occurred in a large south to north swath, the destroyed buildings are largely concentrated around areas near the epicenters of the largest 7.8 and 7.5 magnitude earthquakes that occurred in Gaziantep and Kahramanmaraş, respectively. The destroyed buildings dataset contains 3277 points, but there appears to be very few on the map, likely due to the concentration of destroyed buildings at specific locations.

```{r exploratoryMapsPlots3, fig.align="center", fig.cap="Distribution of Destroyed Building Points", message=FALSE, warning=FALSE, anchor="figure"}
## Destroyed Building Data
# dataset summary
summary(buildings)
# plot destroyed buildings points to see quick distribution
ggplot()+
  geom_sf(data = tur.adm0, fill = "azure", color = "darkgray") +
  geom_point(data = buildings, aes(x=latitude, y=longitude), color = "darkorange3", size = 0.5) +
  labs(title = "Turkiye: Buildings Destroyed in Earthquakes")
```

\newpage

# Analysis
```{r interpolation, message=FALSE, warning=FALSE, echo=FALSE}
#########################
### Spatial Interpolation
#########################

### create spatially interpolated raster surfaces for earthquake and damaged building data

## Earthquake Data: Setup
# maker= EQC df an sf object
EQC.data.sf <- st_as_sf(EQC.data.df, coords = c("longitude", "latitude"), crs = 4326)
# reproject to projected coordinate system from geographic; ESPG 23035; unit = meters
EQC.data.sf.reproj <- st_transform(EQC.data.sf, crs = 23035)
tur.adm0.reproj <- st_transform(tur.adm0, crs = 23035)
tur.adm1.reproj <- st_transform(tur.adm1, crs = 23035)
tur.adm2.reproj <- st_transform(tur.adm2, crs = 23035)
# build blank raster at 10 km resolution; put in same crs as EQC data
blank.rast <- raster(tur.adm0.reproj, res = 10000)


## Earthquake Data: Depth
# formula gstat object; idp = 2 is inverse distance weight interpolation to power of 2
gs.depth <- gstat(formula = depth ~ 1, locations = EQC.data.sf.reproj, set=list(idp = 2))
# interpolate to blank raster
idw.depth <- interpolate (blank.rast, gs.depth, debug.level = 0)
# final idw interpolated raster 
idw.rast.depth <- mask(idw.depth, tur.adm0.reproj)

## Earthquake Data: Magnitude
# formula gstat object; idp = 2 is inverse distance weight interpolation to power of 2
gs.mag <- gstat(formula = mag ~ 1, locations = EQC.data.sf.reproj, set=list(idp = 2))
# interpolate to blank raster
idw.mag <- interpolate (blank.rast, gs.mag, debug.level = 0)
# final idw interpolated raster 
idw.rast.mag <- mask(idw.mag, tur.adm0.reproj)

# reproject buildings to projected coordinate system from geographic to visualize with rasters
# ESPG 23035; unit = meters
buildings.sf <- st_as_sf(buildings, coords = c("longitude", "latitude"), crs = 4326)
buildings.sf.reproj <- st_transform(buildings.sf, crs = 23035)

# write rasters
writeRaster(idw.rast.depth, here("Data/Rasters/TUR_EQC_idw_depth.tif"), format = "GTiff", overwrite = TRUE)
writeRaster(idw.rast.mag, here("Data/Rasters/TUR_EQC_idw_magnitude.tif"), format = "GTiff", overwrite = TRUE)

# create rater dataframes for ggplot
idw.depth.df <- as.data.frame(idw.rast.depth, xy=TRUE) %>% drop_na()
idw.mag.df <- as.data.frame(idw.rast.mag, xy=TRUE) 
```


### Question 2: How is earthquake depth correlated to earthquake magnitude? How are earthquake magnitude and depth of aftershocks related to the earthquake mainshock?

## Running a Generalized Linear regression to examine the relationship between Depth and Magnitude. 

After running a simple single linear regression, there is very little relationship between depth and magnitude of earthquakes, the r-squared is 0.0006317. This suggests that the variation in depth cannot be explained by magnitude. 

```{r GLMsdepthvmagnitude, fig.align="center", fig.cap="Generalized Linear Model relating Depth and Magnitude", message=FALSE, warning=FALSE, anchor="figure"}

#How is depth related to magnitude? Simple linear regression
depth_mag_lm <- lm(EQC.data.df$mag ~ EQC.data.df$depth)
summary(depth_mag_lm)
#It appears that it is not related through a simple linear regression

#Plotting Magnitude vs. Depth
depth_mag_plot <- ggplot(EQC.data.df,aes(x=depth,y=mag,color=EpicenterYN))+
  geom_point()+
  labs(title="Can magnitude be explained by depth?", x="Depth(km)", y="Magnitude")
#print(depth_mag_plot)

#Code to prepare the rasters to run through a simple single linear regression
s <- stack(idw.rast.depth,idw.rast.mag)
v <- data.frame(na.omit(values(s)))
names(v) <- c('idw.rast.depth', 'idw.rast.mag')
depth_mag_rast_lm <- lm(idw.rast.mag ~ idw.rast.depth, data=v)
summary(depth_mag_rast_lm)

```


```{r some data wrangling}

#Extract out the original earthquake
epicenter<- filter(EQC.data.df,mag==7.8)
epi <- filter(EQC.data.sf, mag==7.8)

#Create a column yes or no for original earthquake
EQC.data.df <- EQC.data.df %>%
  mutate(EpicenterYN = ifelse((mag >= 7.5), "yes", "no"))

#Create a distance column from original earthquake

EQC.data.df <- EQC.data.df %>%
  mutate(distance = distance <- st_distance(EQC.data.sf$geometry, epi$geometry) / 1000,.after=longitude)


```

## Running a Generalized Linear regression to examine the relationship between Depth of aftershocks and distance from mainshock. 

Running the same generalized linear model, there is no relationship between depth and distance from the mainshock with an r-squared value of -0.0001214. The variance in depth cannot be explained by distance from the main shock. In the figure \@ref(fig:GLMdepthvdistance) below there is a clear cluster of aftershocks at 10km of depth, this is the 'fixed earthquake depth' which we dicuss more in the Conclusions Section. 

```{r GLMdepthvdistance, fig.align="center", fig.cap="Generalized Linear Model relating Depth of aftershocks and Distance from mainshock", message=FALSE, warning=FALSE, anchor="figure"}

#Can depth be explained by distance from original earthquake
depth_dist_lm <- lm(data = EQC.data.df, depth ~ distance[,1])
summary(depth_dist_lm)

#Plotting Depth vs. Distance from original Earthquake
library(units)
depth_dist_plot <- ggplot(EQC.data.df,aes(x=distance,y=depth,color=EpicenterYN))+
  geom_point()+
  labs(title="Can depth by explained by distance from first earthquake?", x="Distance(km)", y="Depth(km)")
print(depth_dist_plot)

```


## Running a Generalized Linear regression to examine the relationship between Magnitude of aftershocks and distance from mainshock.

Our analysis also indicated no relationship between magnitude and distance from the mainshock with an r-squared value of 0.0007319.You can see from the figure \@ref(fig:GLMmagnitudevdistance) that there is a clustering of aftershocks 0-200 km away between 4 and 5 magnitude. However, as distance increases there is no correlation to magnitude. 


```{r GLMmagnitudevdistance, fig.align="center", fig.cap="Generalized Linear Model relating Magnitude of aftershocks and Distance from mainshock", message=FALSE, warning=FALSE, anchor="figure"}

#Can magnitude be explained by distance from original earthquake
mag_dist_lm <- lm(data = EQC.data.df,mag ~ distance[,1])
summary(mag_dist_lm)

#Plotting Magnitude vs Distance from orgininal Earthquake
mag_dist_plot <- ggplot(EQC.data.df,aes(x=distance,y=mag,color=EpicenterYN))+
  geom_point()+
  labs(title="Can magnitude by explained by distance from first earthquake?", x="Distance(km)", y="Magnitude")
print(mag_dist_plot)

```

##Running a Generalized Linear regression to examine the relationship between Depth of aftershocks and days since mainshock.

Our most significant relationship was the only multiple linear regression test we ran. Looking at both date and time, the variance in depth was 3.771% explained, with a p-value of 0.00005982. This was primarily due to date, with a single linear regression r-squared value of 0.03278. As can be seen in figure \@ref(fig:GLMdepthvtime) many more aftershocks occur in the first 24 hours than later, so the relationship could be partially explained by this tapering off in frequency.


```{r GLMdepthvtime, fig.align="center", fig.cap="Generalized Linear Model relating Depth of aftershocks and Time from mainshock", message=FALSE, warning=FALSE, anchor="figure"}

#Relating depth and magnitude to time

#creating new date and time columns
library(hms)
EQC.data.df <- EQC.data.df %>%
        mutate(date=as.Date(time,format="%Y-%m-%d"),
              .after=time)%>%
  mutate(hms=as_hms(ymd_hms(time)), .after=time)

#Can depth be explained by date
depth_date_lm <-lm(data=EQC.data.df, depth~date)
summary(depth_date_lm)

summary(lm(data=EQC.data.df,depth~hms))

depth_time_lm <-lm(data=EQC.data.df,depth~date+hms)
summary(depth_time_lm)

#Plotting Depth vs Date 
depth_date_plot <-ggplot(EQC.data.df,aes(x=date,y=depth,color=EpicenterYN))+
  geom_point()+
  labs(title="Can depth be explained by Time from original Earthquake(Feb 06)?", x="Date", y="Depth")
print(depth_date_plot)

```


## Running a Generalized Linear regression to examine the relationship between Magnitude of aftershocks and days since mainshock.

Magnitude was 2.45% explained by the multiple linear regression with date and time. This relationship was significant with a p-value of 0.001321. As can be seen above and in figure \@ref(fig:GLMmagnitudevtime) many more aftershocks occur in the first 24 hours than later, so the relationship could be partially explained by this tapering off in frequency.

```{r GLMmagnitudevtime, fig.align="center", fig.cap="Generalized Linear Model relating Magnitude of aftershocks and Time from mainshock", message=FALSE, warning=FALSE, anchor="figure"}


#Can magnitude be explained by date or time
mag_date_lm <- lm(data=EQC.data.df,mag ~ date)
summary(mag_date_lm)

summary(lm(data=EQC.data.df,mag~hms))

mag_time_lm <- lm(data=EQC.data.df, mag ~ date +hms)
summary(mag_time_lm)

#Plotting Magnitude vs Date
mag_date_plot <- ggplot(EQC.data.df,aes(x=date,y=mag,color=EpicenterYN))+
  geom_point()+
  labs(title="Can magnitude by explained by  Time from original Earthquake(Feb 06)?", x="Date", y="Magnitude")
print(mag_date_plot)
```



### Questions 3 and 4: What is the distribution of earthquake-related twitter activity? How does this distribution look in relation to the distribution of destroyed buildings?

```{r plots/visuals}
#plot of the 2 larger earthquakes 
EQC.data.sf.reproj$time <- ymd_hms(EQC.data.sf.reproj$time)

EQSummary <- EQC.data.sf.reproj %>%
  filter(mag == "7.8" | mag == "7.5") %>%
  group_by(time, mag)
print(EQSummary)

##

#plot of the 2 larger earthquakes 
EQC.data.sf.reproj$time <- ymd_hms(EQC.data.sf.reproj$time)

EQSummary <- EQC.data.sf.reproj %>%
  filter(mag == "7.8" | mag == "7.5") %>%
  group_by(time, mag)
print(EQSummary)
plot(EQSummary)


#plot of building distribution v. depth magnitude raster
ggplot()+
  geom_raster(data = idw.depth.df, aes(x=x, y=y, fill=var1.pred)) +
  scale_fill_viridis_c(name = "depth (km)") +
  geom_sf(data = buildings.sf.reproj, color = "brown", size = 0.5) +
  geom_sf(data = tur.adm2.reproj, fill = "transparent", size = 0.3)

#joining ea. of the twitter data to the admin dataframe
TwtHelpJoin <- merge(x = tur.adm2.reproj,
                 y = twt.help,
                 by.x = "shapeName",
                 by.y = "district")

dim(TwtHelpJoin)


TwtMissPersons <- merge(x = tur.adm2.reproj,
                        y = twt.missingPeople,
                        by.x = "shapeName",
                        by.y = "district")

TwtShelter <- merge(x = tur.adm2.reproj,
                        y = twt.shelter,
                        by.x = "shapeName",
                        by.y = "district")

TwtDamage <- merge(x = tur.adm2.reproj,
                        y = twt.damageImages,
                        by.x = "shapeName",
                        by.y = "district")


mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")

#plots of damaged building points
Defaultplot <- ggplot() + 
  geom_sf(data = tur.adm2.reproj, fill = "azure", color = "darkgray") +
  geom_sf(data = buildings.sf.reproj, color = "brown", size = 0.5) 
Defaultplot

```

### Help Requests

Help requests, \@ref(fig:TwtexploratoryMapsPlots4), surrounding the two >7 magnitude earthquake points range from Low, Medium, High, and Very High impact scores. However, the "Very High" impact scores exist nearest
these points and rarely deviate from them (with few exception boundaries). The density of destroyed buildings is hardly reflected by the number of help requests in those same areas, \@ref(fig:exploratoryMapsPlots3).

```{r TwtexploratoryMapsPlots4, fig.align="center", fig.cap="Distribution of Help Requests", message=FALSE, warning=FALSE, anchor="figure"}

#help twitter data
TWTDataHelp <- ggplot() + 
  geom_sf(data = tur.adm2, fill = "azure", color = "darkgray") +
  geom_sf(data = TwtHelpJoin, aes(fill = help_request_impact_category)) +
  geom_sf(data = EQSummary, color = 'red') +
  scale_color_brewer(palette = "YlOrRd") +
  geom_sf(data = tur.adm2.reproj, fill = "azure", color = "darkgray") +
  geom_sf(data = TwtHelpJoin, aes(fill = help_request_impact_category)) +
  geom_sf(data = EQSummary, color = 'blue', alpha = 0.5) +
  scale_fill_manual(values = 
                      c("Very High" = "#E31A1C", 
                        High = "#FD8D3C", 
                        Medium = "#FECC5C", 
                        Low = "#FFFFB2", 
                        "No Reports" = "darkgray"), 
                    breaks=c("Very High", 'High', 'Medium', "Low", "No Reports")) +
  labs(fill = "Help Request Impact Scores", caption = "*Blue points represent earthquakes with magnitude >7*") +
  ggtitle("Reported Help Requests per Depth Coordinates via Twitter") +
  xlab("Longitude") + ylab("Latitude")
  theme(legend.position = "bottom",
    legend.text = element_text(size= 12), 
    legend.title = element_text(size = 12))
  print(TWTDataHelp)

```

### Shelter Requests 
Most boundaries containing "High" and "Very High" impact categories for requesting shelter, \@ref(fig:TwtexploratoryMapsPlots5), are located in the boundaries containing the most damaged/destroyed buildings. Both High and Very High categories exist on or surrounding the \>7 magnitude earthquake points. "Low" to "No Reports" exist further from the \>7 magnitude points.

```{r TwtexploratoryMapsPlots5, fig.align="center", fig.cap="Distirbution of Shelter Requests", message=FALSE, warning=FALSE, anchor="figure"}
  
TWTDataShelter <- ggplot() +
  geom_sf(data = tur.adm2.reproj, fill = "transparent") +
  geom_sf(data = TwtShelter,
          aes(fill = shelter_request_impact_category))+
  geom_sf(data = EQSummary, color = 'blue', alpha = 0.5) +
  scale_fill_brewer(palette = "YlOrRd") +
    scale_fill_manual(values = 
                      c("Very High" = "#E31A1C", 
                        High = "#FD8D3C", 
                        Medium = "#FECC5C", 
                        Low = "#FFFFB2", 
                        "No Reports" = "darkgray"), 
                    breaks=c("Very High", 'High', 'Medium', "Low", "No Reports")) +
  labs(fill = "Shelter Request Impact Category", caption = "*Blue points represent earthquakes with magnitude >7*") +
  ggtitle("Reported Needing Shelter via Twitter") +
  xlab("Longitude") + ylab("Latitude")
  theme(legend.position = "bottom", 
        legend.text = element_text(size= 12), 
        legend.title = element_text(size = 12))
print(TWTDataShelter)

```

### Missing persons 

Our visualization plot for missing persons reports, \@ref(fig:TwtexploratoryMapsPlots6), was most significant in containing the "No Reports" impact category in comparison to all of our Twitter data plots. Where the most No Reports exist, these boundaries do not contain the density (nor any) damaged/destroyed building points.

```{r TwtexploratoryMapsPlots6, fig.align="center", fig.cap="Distirbution of Missing Persons Reports", message=FALSE, warning=FALSE, anchor="figure"}

TWTDataMP <-  ggplot() +
  geom_sf(data = tur.adm2.reproj, fill = "transparent") +
  geom_sf(data = TwtMissPersons,
          aes(fill = missing_people_reports_impact_category))+
  geom_sf(data = EQSummary, color = 'blue', alpha = 0.5) +
    scale_fill_manual(values = 
                      c("Very High" = "#E31A1C", 
                        High = "#FD8D3C", 
                        Medium = "#FECC5C", 
                        Low = "#FFFFB2", 
                        "No Reports" = "darkgray"), 
                    breaks=c("Very High", 'High', 'Medium', "Low", "No Reports")) +
  labs(fill = "Missing Persons Impact Category", caption = "*Blue points represent earthquakes with magnitude >7*") +
  ggtitle("Reported Missing Persons via Twitter") +
  xlab("Longitude") + ylab("Latitude")
  theme(legend.position = "bottom", 
        legend.text = element_text(size= 12), 
        legend.title = element_text(size = 12))
print(TWTDataMP)

```

### Reported Damage 
All reported damage Very High, High, and Medium category points, \@ref(fig:TwtexploratoryMapsPlots7), exist where damaged/destroyed buildings were reported. In comparison, all Low reported damage exist where there are little to no reported destroyed/damaged buildings, \@ref(fig:exploratoryMapsPlots3).

```{r TwtexploratoryMapsPlots7, fig.align="center", fig.cap="Distirbution of Reported Damage", message=FALSE, warning=FALSE, anchor="figure"}

TWTDataDamage <-  ggplot() +
  geom_sf(data = tur.adm2.reproj, fill = "transparent") +
  geom_sf(data = TwtDamage,
          aes(fill = damage_impact_category)) +
  geom_sf(data = EQSummary, color = 'blue', alpha = 0.5) +
    scale_fill_manual(values = 
                      c("Very High" = "#E31A1C", 
                        High = "#FD8D3C", 
                        Medium = "#FECC5C", 
                        Low = "#FFFFB2", 
                        "No Reports" = "darkgray"), 
                    breaks=c("Very High", 'High', 'Medium', "Low", "No Reports")) +
  labs(fill = "Damage Impact Category", caption = "*Blue points represent earthquakes with magnitude >7*") +
  ggtitle("Reported Damage via Twitter") +
  xlab("Longitude") + ylab("Latitude")
  theme(legend.position = "bottom", 
        legend.text = element_text(size= 12), 
        legend.title = element_text(size = 12))
print(TWTDataDamage)


```

\newpage

# Summary and Conclusions
  Below we get into the statistical analyses we did, looking at magnitude and depth related to each as well as distance and time from the 7.8 magnitude mainshock. Before getting into that, a quick explanation of how earthquakes are measured. Magnitude is the strength of the earthquake, measured directly where the rock breaks or shifts and is related to 'strain-drop' and how much the rock is moving after the break or shift that occurred in the Earth's crust after it built up too much tension (or strain) and the size of the seismic waves that will travel through the crust. In other cases intensity is of more interest, the USGS uses the Moderated Mercalli Scale. This is a measure of how people experience the earthquake, with weak ("Many people don't recognize it as an earthquake, vibrations are similar to a passing truck") to extreme ("Some well-build structures destroyed, most masonry and frame structures with foundations destroyed, rails bent"). Intensity is related to both magnitude and depth; higher magnitude earthquakes occurring at shallower depth will result in higher intensity. The earthquake we are looking at was a 7.8 magnitude earthquake that occurred at 10 km depth.

  The statistical result of no relationship between magnitude and depth is backed up by the research on the subject. Earthquakes occur in the crust or upper mantle of the Earth, ranging from 0km to 800 km in depth. Most earthquakes are 'shallow' occurring at depths of 50km or less because the rock is colder and more brittle at this depth and so more likely to break under the strain and deformation of the plate. Deeper earthquakes are more likely to occur at subducting plate boundaries, such as the converging zone in the Pacific Ocean.

 The variance in depth cannot be explained by distance from the main shock. Research suggests that 'shallow' earthquakes produce more aftershocks. You can see in the data that most of the earthquakes seem to occur at 10km of depth. According the the USGS 10km is a 'fixed earthquake depth', when earthquake data can't be used to compute a reliable depth 10km is used. In most earthquake prone zones of the world, reliable depths tend to average 10km or close to it. This may explain the cluster of earthquakes at 10km.

  This was another instance of the variance in magnitude(or depth) being less than 1% explained by our independent variable, in this case distance from the mainshock. Aftershocks are smaller earthquakes that occur on the same fault, as the rock 'realigns' after the 'strain drop' or the large shift that occurred and caused the mainshock of the first earthquake.  

  Our most significant relationship was the only multiple linear regression test we ran for both magnitude and depth. This was primarily due to date in both cases. This relationship is possibly due to the global trend of earthquakes occurring at 10km as well as the drop off in frequency of aftershocks after the mainshock. In the case of magnitude it is probably more due to the decrease in frequency after the first 24 hours. At first this result was somewhat surprising, however, after research according to USGS aftershocks typically taper off in frequency but not magnitude after the mainshock, with strong earthquakes possible late in the series. Aftershocks shortly after the mainshock can be just as large or larger, as with the case of our 7.5 magnitude earthquake occurring less than 24 hours after the mainshock of 7.8 magnitude. This secondary large earthquake caused its own series of aftershocks. Other notable aftershocks include a 6.4 magnitude earthquake on February 20th and a 5.6 magnitude earthquake on February 27th. Aftershocks decrease in frequency within a few days after the mainshock but can still last for weeks to years, with each larger aftershock triggering its own series of aftershocks. This is the case in Türkiye and Syria with aftershocks still occurring today. 

\newpage

# References

Administrative boundaries courtesy of [geoBoundaries](https://www.geoboundaries.org'>geoBoundaries)


“Aftershock Forecast Overview.” Accessed May 1, 2023. https://earthquake.usgs.gov/data/oaf/overview.php.

“At What Depth Do Earthquakes Occur? What Is the Significance of the Depth? | U.S. Geological Survey.” Accessed May 1, 2023. https://www.usgs.gov/faqs/what-depth-do-earthquakes-occur-what-significance-depth.

“Earthquakes: What? Where? How Are They Measured? – Deep Geothermal Heat Research.” Accessed May 1, 2023. https://deepgeothermalheat.engineering.cornell.edu/cubo-science-intro/earthquakes-what-where-how-are-they-measured/.

https://quantectum.com/. “Facts About Earthquake’s Depth.” Accessed May 1, 2023. https://quantectum.com/blog/facts-about-earthquakes-depth/.

Kawoosa, V.M. (2023, March 1). How Turkey has been inundated with aftershocks. *Reuters*. [https://www.reuters.com/graphics/TURKEY-QUAKE/AFTERSHOCKS/dwpkdzklevm/](https://www.reuters.com/graphics/TURKEY-QUAKE/AFTERSHOCKS/dwpkdzklevm/)

Vallée, Martin. “Source Time Function Properties Indicate a Strain Drop Independent of Earthquake Depth and Magnitude.” Nature Communications 4, no. 1 (October 15, 2013): 2606. https://doi.org/10.1038/ncomms3606.

Webb, Paul. “4.8 Earthquakes and Plate Tectonics.” Accessed May 1, 2023. https://rwu.pressbooks.pub/webboceanography/chapter/4-8-earthquakes-and-plate-tectonics/.

“What Is the Difference between Aftershocks and Swarms? | U.S. Geological Survey.” Accessed May 1, 2023. https://www.usgs.gov/faqs/what-difference-between-aftershocks-and-swarms.
